import{p as I,q,d as w,w as h,o as D,h as P,e as b,i as Y,u as F,k as E,f as A,t as u}from"./index-1hkev0sT.js";import{d as f}from"./dayjs.min-Dodf3ejV.js";import{c as l}from"./caja-DXDVpJfs.js";const y=w(b,"pagos_jugadores"),C=async s=>{try{const o=f(),a={...s,fecha_registro:o.format("YYYY-MM-DD")};return(await E(y,a)).id}catch(o){console.error("Error al agregar pago:",o)}},J=async s=>D(y,o=>{const a=o.docs.map(n=>{var i,d,t,g,m;const e=n.data(),r=e.pagos||[];return{id:n.id,jugador:{value:e.jugadorId,label:e.nombre},prorroga:(i=r.find(c=>c.tipo==="Inscripción"))==null?void 0:i.prorroga,fecha_limite:(d=r.find(c=>c.tipo==="Inscripción"))==null?void 0:d.fecha_limite,inscripcion:(t=r.find(c=>c.tipo==="Inscripción"))==null?void 0:t.estatus,pesaje:(g=r.find(c=>c.tipo==="Pesaje"))==null?void 0:g.estatus,equipamiento:(m=r.find(c=>c.tipo==="Equipamiento"))==null?void 0:m.estatus,...n.data()}});s(a)}),M=async(s,o)=>{try{return(await I(q(y,h("temporadaId","==",s),h("categoria","==",o)))).docs.map(e=>{var d,t,g,m,c,j;const r=e.data(),i=r.pagos||[];return{id:e.id,jugador:{value:r.jugadorId,label:r.nombre},prorroga:(d=i.find(p=>p.tipo==="Inscripción"))==null?void 0:d.prorroga,fecha_limite:(t=i.find(p=>p.tipo==="Inscripción"))==null?void 0:t.fecha_limite,inscripcion:(g=i.find(p=>p.tipo==="Inscripción"))==null?void 0:g.estatus,tunel:(m=i.find(p=>p.tipo==="Túnel"))==null?void 0:m.estatus,botiquin:(c=i.find(p=>p.tipo==="Botiquín"))==null?void 0:c.estatus,coacheo:(j=i.find(p=>p.tipo==="Coaching"))==null?void 0:j.estatus,...e.data()}})}catch(a){return console.error("Error al obtener porristas:",a),[]}},R=async(s,o)=>{try{const a=o.pagos.find(t=>t.tipo==="Inscripción"),n=o.pagos.find(t=>t.tipo==="Pesaje"),e=o.pagos.find(t=>t.tipo==="Equipamiento");if(a.abono==="SI"){Array.isArray(a.abonos)||(a.abonos=[]),a.abonos.push({cantidad:o.cantidad_abono_ins,fecha:o.fecha_abono_ins,metodo:o.metodo_pago_abono_ins}),a.total_abonado=parseFloat(o.cantidad_abono_ins)+parseFloat(a.total_abonado||0),a.abono="NO";const t={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de inscripción (abono)",fecha_pago:o.fecha_abono_ins||i,total:o.cantidad_abono_ins||0,metodo_pago:o.metodo_pago_abono_ins||null};await l(t)}if(n.abono==="SI"){Array.isArray(n.abonos)||(n.abonos=[]),n.abonos.push({cantidad:o.cantidad_abono_pesaje,fecha:o.fecha_abono_pesaje,metodo:o.metodo_pago_abono_pesaje}),n.total_abonado=parseFloat(o.cantidad_abono_pesaje)+parseFloat(n.total_abonado||0),n.abono="NO";const t={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de pesaje (abono)",fecha_pago:o.fecha_abono_pesaje||i,total:o.cantidad_abono_pesaje||0,metodo_pago:o.metodo_pago_abono_pesaje||null};await l(t)}if(e.abono==="SI"){Array.isArray(e.abonos)||(e.abonos=[]),e.abonos.push({cantidad:o.cantidad_abono_equipamiento,fecha:o.fecha_abono_equipamiento,metodo:o.metodo_pago_abono_equipamiento}),e.total_abonado=parseFloat(o.cantidad_abono_equipamiento)+parseFloat(e.total_abonado||0),e.abono="NO";const t={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de equipamiento (abono)",fecha_pago:o.fecha_abono_equipamiento||i,total:o.cantidad_abono_equipamiento||0,metodo_pago:o.metodo_pago_abono_equipamiento||null};await l(t)}const r={...o,pagos:o.pagos.map(t=>({...t}))},i=f().format("YYYY-MM-DD");if(a.estatus==="pagado"){const t={jugadorId:r.jugadorId,nombre:r.nombre,tabla:"Jugador",concepto:"Pago de inscripción",fecha_pago:a.fecha_pago||i,total:a.monto||0,metodo_pago:a.metodo_pago||null};await l(t)}if(n.estatus==="pagado"){const t={jugadorId:r.jugadorId,nombre:r.nombre,tabla:"Jugador",concepto:"Pago de pesaje",fecha_pago:n.fecha_pago||i,total:n.monto||0,metodo_pago:n.metodo_pago||null};await l(t)}if(e.estatus==="pagado"){const t={jugadorId:r.jugadorId,nombre:r.nombre,tabla:"Jugador",concepto:"Pago de equipamiento",fecha_pago:e.fecha_pago||i,total:e.monto||0,metodo_pago:e.metodo_pago||null};await l(t)}delete o.jugador,delete o.equipamiento,delete o.inscripcion,delete o.prorroga,delete o.pesaje,delete o.fecha_limite,delete o.cantidad_abono_ins,delete o.fecha_abono_ins,delete o.metodo_pago_abono_ins,delete o.cantidad_abono_equipamiento,delete o.fecha_abono_equipamiento,delete o.metodo_pago_abono_equipamiento,delete o.cantidad_abono_pesaje,delete o.fecha_abono_pesaje,delete o.metodo_pago_abono_pesaje;const d=P(b,"pagos_jugadores",s);await F(d,o)}catch(a){console.error("Error al actualizar pago:",a)}},S=async s=>{try{const o=P(b,"pagos_jugadores",s);await Y(o)}catch(o){console.error("Error al eliminar pago:",o)}};let _=null;const N=A((s,o)=>({payments:[],loading:!1,getDataPaymentsPlayer:async()=>(s({loading:!0}),new Promise((a,n)=>{try{_?a(o().payments):_=J(e=>{s({payments:e}),a(e)})}catch(e){console.error(e),n(e)}finally{s({loading:!1})}})),getDataFilter:async(a,n)=>{const e=await M(a,n);_=null,s({payments:e})},addPayment:async a=>{const n=async()=>{try{const r=f().add(1,"week").format("YYYY/MM/DD");a.pagos[0].fecha_limite=r,a.jugadorId=a.jugador.value,a.nombre=a.jugador.label,delete a.jugador,await C(a)}catch(e){console.error(e)}};u.promise(n(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editPayment:async a=>{const n=async()=>{try{await R(a.id,a)}catch(e){console.error(e)}};u.promise(n(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deletePayment:async a=>{const n=async()=>{try{await S(a)}catch(e){console.error(e)}};u.promise(n(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}}));export{N as u};
