import{t as N,j as a,r as M}from"./index-1hkev0sT.js";import{B as R,a as B}from"./ButtonsModal-DwgSUSF5.js";import{B as L}from"./BaseTable-DI_i5Uvm.js";import{M as $}from"./ModalDelete-BZuhmeM_.js";import{u as p,a as k,I as S}from"./InputField-GuZ0OZJf.js";import{S as _}from"./sweetalert2.esm.all-B0Dix5B2.js";import{u as f}from"./useCheerleaderStore-C5AakXzS.js";import{u as G}from"./useUserStore-DERwkIQe.js";import{u as T}from"./uploadFile-Dm2sN9KE.js";import{j as K}from"./schemas-Ch0jrM0J.js";import{u as V}from"./useTemporadasStore-D6fgAS8s.js";import{A as w}from"./AlertaCard-CkpJgsto.js";import{C as z}from"./CancelButtonModal-BY77VJ91.js";import{S as H}from"./SignatureInput-DT0OmnsA.js";import"./dayjs.min-Dodf3ejV.js";import"./chevron-right-CQV0O4Z1.js";import"./players-BzdLQVIf.js";import"./costos-porrista-BRwTdeOH.js";import"./es-rjeHZEeQ.js";import"./square-pen-Da5ptJOH.js";import"./eye-Brg_21Lh.js";import"./categorias-BT_gOMst.js";import"./roles-BwQ-Xixw.js";import"./index-DFv_9v-T.js";const A=()=>{const t=G(e=>e.getDataUsers),n=V(e=>e.getDataTemporadas),o=p(e=>e.modalType),l=p(e=>e.formData),m=p(e=>e.setFormData),u=p(e=>e.closeModal),d=p(e=>e.firma),x=p(e=>e.editFirma),F=f(e=>e.loading),C=f(e=>e.cheerleader),D=f(e=>e.getDataCheerleaders),q=f(e=>e.addCheerleader),i=f(e=>e.editCheerleader),g=f(e=>e.deleteCheerleader);return{loadOptions:async()=>{try{return(await t()).map(s=>({value:s.id,label:s.nombre_completo}))}catch(e){return console.error("Error loading users:",e),[]}},cheerleader:C,loading:F,getDataCheerleaders:D,handleSubmit:async e=>{e.preventDefault();const s=K.safeParse(l);if(!s.success){const r=s.error.flatten().fieldErrors,h=Object.values(r)[0][0];N.error(h);return}let P=null;if(d===null&&o==="add"){N.warning("La firma es obligatoría.");return}else d===null&&o==="edit"?P=l.documentos.firma:d!==null&&(P=d);_.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{_.showLoading()}});try{const r={...l,curp:l.curp.toUpperCase(),uid:l.uid.value,documentos:{...l.documentos,firma:P}};if(r.documentos){const h=`porristas/${r.uid}/documentos/${r.curp}`;for(const v in r.documentos){const O=r.documentos[v];if(O instanceof File){const I=await T(O,h);r.documentos[v]=I}}}if(r.foto&&r.foto instanceof File){const h=`porristas/${r.uid}/fotos/${r.curp}`,v=await T(r.foto,h);r.foto=v}o==="add"?await q(r):o==="edit"&&await i(r)}catch(r){throw console.error("Ocurrio un error",r),new Error("Ocurrió un error",r.message)}finally{_.close(),u(),x(null)}},handleDelete:async e=>{try{await g(e)}catch(s){throw console.error("Ocurrio un error",s),new Error("Ocurrió un error",s.message)}finally{u()}},handleReglamento:()=>{m("acepta_reglamento",!0)},loadOptionsTemporadas:async()=>{try{return(await n()).map(s=>({value:s.id,label:s.temporada}))}catch(e){return console.error("Error loading data:",e),[]}}}},E={generalFields:[{required:!0,type:"text",label:"Nombre",name:"nombre"},{required:!0,type:"text",label:"Apellido paterno",name:"apellido_p"},{required:!0,type:"text",label:"Apellido materno",name:"apellido_m"},{required:!0,type:"select",label:"Sexo",name:"sexo",opcSelect:[{value:"mujer",label:"Mujer"}]},{required:!0,type:"text",label:"Dirección completa",name:"direccion"},{required:!0,type:"tel",label:"Teléfono",name:"telefono"},{required:!0,type:"date",label:"Fecha de nacimiento",name:"fecha_nacimiento"},{required:!0,type:"text",label:"Lugar de nacimiento",name:"lugar_nacimiento"},{required:!0,type:"text",label:"CURP",name:"curp"},{required:!0,type:"select",label:"Grado escolar",name:"grado_escolar",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"primaria",label:"Primaria"},{value:"secundaria",label:"Secundaria"},{value:"preparatoria",label:"Preparatoria"}]},{required:!0,type:"text",label:"Nombre de la escuela",name:"nombre_escuela"},{required:!0,type:"text",label:"Alergias",name:"alergias"},{required:!0,type:"text",label:"Padecimientos",name:"padecimientos"},{required:!0,type:"number",label:"Peso (kg)",name:"peso"},{required:!0,type:"async",label:"Tutor",name:"uid"},{required:!0,type:"file",label:"Foto de la porrista",name:"foto",accept:"image/*"}],documentFields:[{required:!0,type:"file",label:"CURP de la porrista (PDF)",name:"curp_jugador",accept:"application/pdf"},{required:!0,type:"file",label:"INE del tutor (PDF)",name:"ine_tutor",accept:"application/pdf"},{required:!0,type:"file",label:"Acta de nacimiento (PDF)",name:"acta_nacimiento",accept:"application/pdf"},{required:!0,type:"file",label:"Comprobante de domicilio (PDF)",name:"comprobante_domicilio",accept:"application/pdf"}]},U="/assets/reglamento_porristas-Dbeof0dg.pdf",J=()=>{const{view:t,document:n,formData:o,handleInputChange:l,handleFileChange:m}=k(),{loadOptions:u,sigCanvas:d,clearSignature:x,saveSignature:F,handleReglamento:C,loadOptionsTemporadas:D}=A(),q=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return a.jsx(a.Fragment,{children:o.acepta_reglamento||n?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[a.jsx(w,{text:"Temporada"}),a.jsx(S,{type:"async",label:"Selecciona la temporada *",name:"temporadaId",required:!0,value:o.temporadaId,onChange:l,disabled:t,loadOptions:D,classInput:"md:col-span-2"}),a.jsx(w,{text:"Datos generales"}),E.generalFields.map(({type:i,label:g,name:c,opcSelect:y,accept:j,required:b})=>a.jsx(S,{type:i,label:g,name:c,required:i==="file"&&n?!1:b,value:o[c]||"",onChange:i==="file"?m:l,disabled:t,opcSelect:y,loadOptions:i==="async"?u:()=>{},accept:j,document:i==="file"&&n},c)),a.jsx(w,{text:"Documentos"}),E.documentFields.map(({type:i,label:g,name:c,accept:y,required:j})=>{var b;return a.jsx(S,{type:i,accept:y,label:g,required:n?!1:j,name:`documentos.${c}`,value:((b=o.documentos)==null?void 0:b[c])||"",onChange:m,disabled:t,document:n},c)}),a.jsx(w,{text:"Firma del tutor"}),a.jsx(H,{view:t,formData:o,sigCanvas:d,clearSignature:x,saveSignature:F})]}),a.jsx("hr",{className:"text-gray-300"}),t?a.jsx(z,{}):a.jsx(R,{})]}):q?a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"mb-4 text-gray-700 font-medium",children:"El visor no está disponible en móvil. Puedes abrir o descargar el reglamento aquí:"}),a.jsx("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-all",download:!0,children:"Descargar reglamento"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-5 ",children:a.jsx("button",{onClick:C,type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm cursor-pointer transition-all",children:"¿El padre, madre o tutor acepta el reglamento?"})}),a.jsx("div",{className:"w-full h-[100dvh]",children:a.jsx("iframe",{src:U,className:"w-full h-full border-none",title:"Visor PDF"})})]})})},Q=[{key:"nombre",name:"Nombre"},{key:"apellido_p",name:"Apellido paterno"},{key:"apellido_m",name:"Apellido materno"},{key:"curp",name:"CURP"}];function ve(){const{modalType:t,currentItem:n}=k(),{cheerleader:o,loading:l,getDataCheerleaders:m,handleSubmit:u,handleDelete:d}=A();return M.useEffect(()=>{(async()=>await m())()},[m]),a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(L,{columns:Q,data:o,title:"Porristas",loading:l}),(t==="add"||t==="edit"||t==="view")&&a.jsx(B,{handleSubmit:u,Inputs:a.jsx(J,{})}),t==="delete"&&n&&a.jsx($,{handleDelete:d})]})}export{ve as default};
