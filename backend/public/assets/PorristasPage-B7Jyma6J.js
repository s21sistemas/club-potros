import{t as _,j as r,r as R}from"./index-Bo_1Zqy6.js";import{B,a as I}from"./ButtonsModal-rjNumsnu.js";import{B as T}from"./BaseTable-CG0hieRc.js";import{M as L}from"./ModalDelete-C1zEzITC.js";import{u,a as k,I as N}from"./InputField-Bgiqn5r0.js";import{S as q}from"./sweetalert2.esm.all-B0Dix5B2.js";import{u as m}from"./useCheerleaderStore-vrJINJqI.js";import{u as $}from"./useUserStore-CZkNokb2.js";import{u as E}from"./uploadFile-a4HQ_AO3.js";import{j as G}from"./schemas-Ch0jrM0J.js";import{A as P}from"./AlertaCard-Y7DSOmzU.js";import{C as K}from"./CancelButtonModal-C6qEQDgJ.js";import{S as z}from"./SignatureInput-BoqHMK9n.js";import"./dayjs.min-C6mA835O.js";import"./chevron-right-BHG4n6AS.js";import"./players-CfGsYTWQ.js";import"./es-BFm7WDBc.js";import"./square-pen-C_HaDAF2.js";import"./eye-DdfdWaaB.js";import"./categorias-DKNPRs5G.js";import"./roles-BUDpW5ak.js";import"./index-Ca4VRa6N.js";const A=()=>{const l=$(e=>e.getDataUsers),o=u(e=>e.modalType),t=u(e=>e.formData),p=u(e=>e.setFormData),n=u(e=>e.closeModal),i=u(e=>e.firma),f=u(e=>e.editFirma),x=m(e=>e.loading),w=m(e=>e.cheerleader),v=m(e=>e.getDataCheerleaders),C=m(e=>e.addCheerleader),s=m(e=>e.editCheerleader),g=m(e=>e.deleteCheerleader);return{loadOptions:async()=>{try{return(await l()).map(c=>({value:c.id,label:c.nombre_completo}))}catch(e){return console.error("Error loading users:",e),[]}},cheerleader:w,loading:x,getDataCheerleaders:v,handleSubmit:async e=>{e.preventDefault();const c=G.safeParse(t);if(!c.success){const a=c.error.flatten().fieldErrors,h=Object.values(a)[0][0];_.error(h);return}let D=null;if(i===null&&o==="add"){_.warning("La firma es obligatoría.");return}else i===null&&o==="edit"?D=t.documentos.firma:i!==null&&(D=i);q.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{q.showLoading()}});try{const a={...t,curp:t.curp.toUpperCase(),uid:t.uid.value,documentos:{...t.documentos,firma:D}};if(a.documentos){const h=`porristas/${a.uid}/documentos/${a.curp}`;for(const F in a.documentos){const S=a.documentos[F];if(S instanceof File){const M=await E(S,h);a.documentos[F]=M}}}if(a.foto&&a.foto instanceof File){const h=`porristas/${a.uid}/fotos/${a.curp}`,F=await E(a.foto,h);a.foto=F}o==="add"?await C(a):o==="edit"&&await s(a)}catch(a){throw console.error("Ocurrio un error",a),new Error("Ocurrió un error",a.message)}finally{q.close(),n(),f(null)}},handleDelete:async e=>{try{await g(e)}catch(c){throw console.error("Ocurrio un error",c),new Error("Ocurrió un error",c.message)}finally{n()}},handleReglamento:()=>{p("acepta_reglamento",!0)}}},O={generalFields:[{required:!0,type:"text",label:"Nombre",name:"nombre"},{required:!0,type:"text",label:"Apellido paterno",name:"apellido_p"},{required:!0,type:"text",label:"Apellido materno",name:"apellido_m"},{required:!0,type:"select",label:"Sexo",name:"sexo",opcSelect:[{value:"mujer",label:"Mujer"}]},{required:!0,type:"text",label:"Dirección completa",name:"direccion"},{required:!0,type:"tel",label:"Teléfono",name:"telefono"},{required:!0,type:"date",label:"Fecha de nacimiento",name:"fecha_nacimiento"},{required:!0,type:"text",label:"Lugar de nacimiento",name:"lugar_nacimiento"},{required:!0,type:"text",label:"CURP",name:"curp"},{required:!0,type:"select",label:"Grado escolar",name:"grado_escolar",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"primaria",label:"Primaria"},{value:"secundaria",label:"Secundaria"},{value:"preparatoria",label:"Preparatoria"}]},{required:!0,type:"text",label:"Nombre de la escuela",name:"nombre_escuela"},{required:!0,type:"text",label:"Alergias",name:"alergias"},{required:!0,type:"text",label:"Padecimientos",name:"padecimientos"},{required:!0,type:"number",label:"Peso (kg)",name:"peso"},{required:!0,type:"async",label:"Tutor",name:"uid"},{required:!0,type:"file",label:"Foto de la porrista",name:"foto",accept:"image/*"}],documentFields:[{required:!0,type:"file",label:"CURP de la porrista (PDF)",name:"curp_jugador",accept:"application/pdf"},{required:!0,type:"file",label:"INE del tutor (PDF)",name:"ine_tutor",accept:"application/pdf"},{required:!0,type:"file",label:"Acta de nacimiento (PDF)",name:"acta_nacimiento",accept:"application/pdf"},{required:!0,type:"file",label:"Comprobante de domicilio (PDF)",name:"comprobante_domicilio",accept:"application/pdf"}]},U="/assets/reglamento_jugadores-D6jtDzK8.pdf",V=()=>{const{view:l,document:o,formData:t,handleInputChange:p,handleFileChange:n}=k(),{loadOptions:i,sigCanvas:f,clearSignature:x,saveSignature:w,handleReglamento:v}=A(),C=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return r.jsx(r.Fragment,{children:t.acepta_reglamento||o?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[r.jsx(P,{text:"Datos generales"}),O.generalFields.map(({type:s,label:g,name:d,opcSelect:y,accept:j,required:b})=>r.jsx(N,{type:s,label:g,name:d,required:s==="file"&&o?!1:b,value:t[d]||"",onChange:s==="file"?n:p,disabled:l,opcSelect:y,loadOptions:s==="async"?i:()=>{},accept:j,document:s==="file"&&o},d)),r.jsx(P,{text:"Documentos"}),O.documentFields.map(({type:s,label:g,name:d,accept:y,required:j})=>{var b;return r.jsx(N,{type:s,accept:y,label:g,required:o?!1:j,name:`documentos.${d}`,value:((b=t.documentos)==null?void 0:b[d])||"",onChange:n,disabled:l,document:o},d)}),r.jsx(P,{text:"Firma del tutor"}),r.jsx(z,{view:l,formData:t,sigCanvas:f,clearSignature:x,saveSignature:w})]}),r.jsx("hr",{className:"text-gray-300"}),l?r.jsx(K,{}):r.jsx(B,{})]}):C?r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"mb-4 text-gray-700 font-medium",children:"El visor no está disponible en móvil. Puedes abrir o descargar el reglamento aquí:"}),r.jsx("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-all",download:!0,children:"Descargar reglamento"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-5 ",children:r.jsx("button",{onClick:v,type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm cursor-pointer transition-all",children:"¿El padre, madre o tutor acepta el reglamento?"})}),r.jsx("div",{className:"w-full h-[100dvh]",children:r.jsx("iframe",{src:U,className:"w-full h-full border-none",title:"Visor PDF"})})]})})},H=[{key:"nombre",name:"Nombre"},{key:"apellido_p",name:"Apellido paterno"},{key:"apellido_m",name:"Apellido materno"},{key:"curp",name:"CURP"}];function be(){const{modalType:l,currentItem:o}=k(),{cheerleader:t,loading:p,getDataCheerleaders:n,handleSubmit:i,handleDelete:f}=A();return R.useEffect(()=>{(async()=>await n())()},[n]),r.jsxs("div",{className:"md:p-4 bg-gray-100",children:[r.jsx(T,{columns:H,data:t,title:"Porristas",loading:p}),(l==="add"||l==="edit"||l==="view")&&r.jsx(I,{handleSubmit:i,Inputs:r.jsx(V,{})}),l==="delete"&&o&&r.jsx(L,{handleDelete:f})]})}export{be as default};
